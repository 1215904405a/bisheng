/*! Hyde.js 21-12-2013 */

"use strict";!function(a){var b=a();b(a,function(){window.expose=b})}(function(){function a(a,b){"object"==typeof module&&module.exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"function"==typeof define&&define.cmd?define(a):"undefined"!=typeof KISSY?KISSY.add(a):b&&b()}return a}),function(a){expose(a,function(){window.Loop=a()})}(function(){function a(){clearTimeout(i);for(var b=0;b<k.length;b++)k[b]&&k[b]();i=setTimeout(a,50)}function b(a,b){function c(){var c=e(a,g,[f],!0);c&&c.length&&(b(c,a,g),g=d(a,!0,[f]))}var f=j++,g=d(a,!0,[f]);return c.data=a,k.push(c),g}function c(a,b){function c(a){for(var b=0;b<k.length;b++)a(k[b])&&k.splice(b--,1)}"function"==typeof b&&c(function(c){return c===b&&c.data===a}),"function"==typeof a&&c(function(a){return a===b}),void 0!==a&&c(function(b){return b.data===a})}function d(a,b,c){var e,f,g=a.constructor();if(c=c||[],null===a||"object"!=typeof a)return a;b&&(g.$path=c.join("."));for(e in a)f=a[e],void 0!==f&&(f.constructor===Object||f.constructor===Array?f=d(f,b,c.concat(e)):b&&(f=new Object(f),f.$path=c.concat(e).join("."))),g[e]=f;return g}function e(a,b,c,d){function e(a,b){return function(){for(var c=a,d=1;d<b.length-1;d++)c=c[b[d]];return c}}var i=i||[];if(c=c||[],("object"!=typeof a||"object"!=typeof b)&&i.length)return i;if(f(a,b,c,i),g(a,b,c,i),h(a,b,c,i),d)for(var j,k=0;k<i.length;k++)j=i[k],j.root=a,j.context=e(a,j.path)(),j.getContext=e;return i.length?i:void 0}function f(a,b,c,d,e){var g,h;for(g in a)/\$guid|\$path|\$blocks|\$helpers/.test(g)||(h=a[g],g in b?void 0!==h&&void 0!==b[g]&&h.constructor===b[g].constructor&&(h.constructor===Object||h.constructor===Array)&&f(h,b[g],c.concat(g),d,e):d.push({type:e||l.ADD,path:c.concat(g),value:a[g]}));return d.length?d:void 0}function g(a,b,c,d){return f(b,a,c,d,l.DELETE)}function h(a,b,c,d){var e,f;for(e in a)/\$guid|\$path|\$blocks|\$helpers/.test(e)||(f=a[e],e in b&&(void 0!==f||void 0!==b[e])&&(void 0!==f&&void 0!==b[e]&&f.constructor===b[e].constructor?f.constructor!==Object&&f.constructor!==Array?f.valueOf()!==b[e].valueOf()&&d.push({type:l.UPDATE,path:c.concat(e),value:f,oldValue:b[e]}):h(f,b[e],c.concat(e),d):d.push({type:l.UPDATE,path:c.concat(e),value:f,oldValue:void 0!==b[e]?b[e].valueOf():b[e]})));return d.length?d:void 0}var i,j=1,k=[];i=setTimeout(a,50);var l={ADD:"add",DELETE:"delete",UPDATE:"update"};return{TYPES:l,watch:b,unwatch:c,clone:d,diff:e,letMeSee:a}}),function(a){expose(a,function(){window.AST=a()})}(function(){var a=1,b=Handlebars.helpers["if"];return Handlebars.registerHelper("if",function(a,c){return b.call(this,void 0!==a?a.valueOf():a,c)}),Handlebars.registerHelper("$lastest",function(a){return a&&a.$path||this&&this.$path}),{createPathHTML:function(a){var b=Handlebars.Utils.escapeExpression,c=b("<script");for(var d in a)void 0!==a[d]&&(c+=" "+d+b('="')+a[d]+b('"'));return c+=b("></script>")},handle:function(a,b,c,d,e){return 2===arguments.length&&(d=b,b=void 0,e={}),3===arguments.length&&(d=b,e=c,b=c=void 0),this[a.type]&&this[a.type](a,b,c,d,e),a},program:function(a,b,c,d,e){for(var f=0;f<a.statements.length;f++)this.handle(a.statements[f],a.statements,f,d,e)},mustache:function(b,c,d,e,f){if(!b.binded){var g=[];b.isHelper?b.params.forEach(function(a){"ID"===a.type&&g.push(a.string)}):g.push(b.id.string),g=g.join(" ");var h,i,j={guid:a,slot:"",type:"",path:"{{$lastest "+g+"}}",isHelper:!!b.isHelper};j.slot="start",h=this.createPathHTML(j),i=Handlebars.parse(h).statements,i[1].binded=!0,c.splice.apply(c,[d,0].concat(i)),h=this.createPathHTML({guid:j.guid,slot:"end"}),i=Handlebars.parse(h).statements,c.splice.apply(c,[d+4,0].concat(i)),f&&(f[a++]={constructor:Handlebars.AST.ProgramNode,type:"program",statements:[b]}),b.binded=!0}},block:function(b,c,d,e,f){if(!b.binded){var g,h;0===b.mustache.params.length?(g="",h=b.mustache.id.string):(g=b.mustache.id.string,h=b.mustache.params[0].string);var i,j,k={guid:a,slot:"",type:"block",path:"{{$lastest "+h+"}}",helper:g};k.slot="start",i=this.createPathHTML(k),j=Handlebars.parse(i).statements,j[1].binded=!0,c.splice.apply(c,[d,0].concat(j)),i=this.createPathHTML({guid:k.guid,slot:"end"}),j=Handlebars.parse(i).statements,c.splice.apply(c,[d+4,0].concat(j)),e&&(e[a++]={constructor:Handlebars.AST.ProgramNode,type:"program",statements:[b]}),b.binded=!0,this.handle(b.program||b.inverse,c,d,e,f)}}}}),function(a){expose(a,function(){window.scan=a()})}(function(){function a(a,c){b(a),f(a),g(a,c)}function b(a){switch(a.nodeType){case 1:case 9:case 11:d(a),e(a);break;case 3:c(a)}}function c(a){var b=a.textContent||a.innerText||a.nodeValue;$("<div>"+b+"</div>").contents().each(function(a,b){"SCRIPT"===b.nodeName&&b.getAttribute("path")&&(b.getAttribute("type")||b.setAttribute("type","text"))}).replaceAll(a)}function d(a){var b=/(<script(?:.*?)><\/script>)/gi,c=/([^;]*?): ([^;]*)/gi,d=[];$.each(function(){for(var b=[],c=a.attributes,d=0;d<c.length;d++)b.push(c[d]);return b}(),function(e,f){if(f.specified){var g,h,i=f.nodeName,j=f.nodeValue;if("style"===i)for(c.exec("");h=c.exec(j);)for(b.exec("");g=b.exec(h[2]);)d.push($("<div>"+g[1]+"</div>").contents().attr({type:"attribute",name:f.nodeName.toLowerCase(),css:$.trim(h[1])})[0]);else for(b.exec("");g=b.exec(j);)d.push($("<div>"+g[1]+"</div>").contents().attr({type:"attribute",name:f.nodeName.toLowerCase()})[0]);d.length&&(j=j.replace(b,""),f.nodeValue=j,$(d).each(function(b,c){var d=$(c).attr("slot");"start"===d&&$(a).before(c),"end"===d&&$(a).after(c)}))}})}function e(a){$(a.childNodes).each(function(a,c){b(c)})}function f(a){var b,c='script[slot="start"][type="block"]',d=$(c);d.each(function(c,d){if(8===d.nextSibling.nodeType){b=d.nextSibling.nodeValue,b=b.split(","),b=b.length>2?b.slice(0,-1).join("."):b,d.setAttribute("path",b);var e=d.getAttribute("guid");slice.call(a.querySelectorAll('script[slot="end"][guid="'+e+'"]')||[],0).forEach(function(a){a.setAttribute("path",b)})}})}function g(a,b){$('script[slot="start"][type="attribute"][name="value"]',a).each(function(a,c){for(var d=$(c).attr("path").split("."),e=c;(e=e.nextSibling)&&"script"===e.nodeName.toLowerCase(););$(e).on("keyup",function(a){h(b,d,a.target)})}),$('script[slot="start"][type="attribute"][name="checked"]',a).each(function(a,c){for(var d=$(c).attr("path").split("."),e=c;(e=e.nextSibling)&&"script"===e.nodeName.toLowerCase(););for(var f=b,g=1;g<d.length;g++)f=f[d[g]];(void 0===f||f.valueOf()===!1||"false"===f.valueOf())&&$(e).prop("checked",!1),$(e).on("change",function(a){i(b,d,a.target)})})}function h(a,b,c){for(var d=1;d<b.length-1;d++)a=a[b[d]];var e,f=$(c);switch(c.nodeName.toLowerCase()){case"input":switch(c.type){case"text":f.data("user is editing",!0),e=f.val();break;case"radio":case"checkbox":return;default:e=f.val()}break;case"select":e=f.val();break;case"textarea":e=f.val();break;default:e=f.val()}a[b[b.length-1]]=e}function i(a,b,c){for(var d=1;d<b.length-1;d++)a=a[b[d]];var e,f=$(c);switch(c.nodeName.toLowerCase()){case"input":switch(c.type){case"radio":case"checkbox":e=f.prop("checked")}}a[b[b.length-1]]=e}return a}),"object"==typeof module&&module.exports&&(window=require("jsdom").jsdom().createWindow(),document=window.document),function(a){expose(a,function(){window.Flush=a()})}(function(){function a(a){for(;a=a.nextSibling;)if("SCRIPT"!==a.nodeName)return a}function b(a,c,d){var e,f='script[slot="start"][path="'+c.path.join(".")+'"]',g=$(f);0===g.length&&c.context instanceof Array&&(c.path.pop(),c.context=c.getContext(c.root,c.path)(),b(a,c,d)),g.each(function(f,g){e=g.getAttribute("type"),b[e]&&b[e](g,a,c,d)})}function c(a){}function d(a){a.target.nodeType&&(a.target=[a.target]),a.target.forEach&&a.target.forEach(function(a){switch(a.nodeType){case 3:$(a).wrap("<span>").parent().addClass("transition highlight"),setTimeout(function(){$(a).unwrap("<span>").removeClass("transition highlight")},500);break;case 1:$(a).addClass("transition highlight"),setTimeout(function(){$(a).removeClass("transition highlight")},500)}})}return b.text=function(a,b,c,d){for(var e,f=a.getAttribute("guid"),g=a.getAttribute("helper"),h=$('script[slot="end"][guid="'+f+'"]')[0],i=[],j=a,k=h;(j=j.nextSibling)&&j!==k;)i.push(j);1===i.length&&3===i[0].nodeType?(b.target.push(i[0]),i[0].nodeValue=c.value):(e="true"===g?Handlebars.compile(d.$helpers[f])(c.context):c.value,$("<div>"+e+"</div>").contents().insertAfter(a).each(function(a,c){b.target.push(c)}),$(i).remove())},b.attribute=function(b,c,d,e){var f,g,h;c.target.push(f=a(b)),h=$(f);var i=e.$blocks[b.getAttribute("guid")],j=i?Handlebars.compile(i)(d.context):d.value,k=function(){var a;return d.context[d.path[d.path.length-1]]=void 0!==d.oldValue?d.oldValue.valueOf():d.oldValue,a=i?Handlebars.compile(i)(d.context):d.oldValue,d.context[d.path[d.path.length-1]]=d.value,a}();switch(g=b.getAttribute("name")){case"class":h.removeClass(""+k).addClass(""+j);break;case"style":h.css(b.getAttribute("css"),j);break;case"value":h.val()===j||h.data("user is editing")||h.val(j),h.data("user is editing",!1);break;case"checked":h.prop(g,j),g=h.attr("name"),g&&h.prop("checked")&&setTimeout(function(){d.context[g]=h.val()},0);break;default:h.attr(g,function(a,b){return void 0===k?j:b!==k.valueOf()?b.replace(k,j):j})}},b.block=function(a,b,c,d){var e=a.getAttribute("guid"),f=document.querySelector('script[slot="end"][guid="'+e+'"]'),g=d.$blocks[e],h=Loop.clone(c.context,!0,c.path.slice(0,-1)),i=Handlebars.compile(g)(h);i=$("<div>"+i+"</div>"),scan(i[0],c.context),i=i.contents();for(var j=[],k=a,l=f;(k=k.nextSibling)&&k!==l;)j.push(k);i.length<j.length&&$(j.splice(i.length)).remove(),i.each(function(a,c){return j[a]?c.nodeType!==j[a].nodeType?(j[a].parentNode.insertBefore(c,j[a]),j[a].parentNode.removeChild(j[a]),b.target.push(c),void 0):3===c.nodeType&&c.nodeValue!==j[a].nodeValue?(j[a].nodeValue=c.nodeValue,void 0):8===c.nodeType&&c.nodeValue!==j[a].nodeValue?(j[a].nodeValue=c.nodeValue,void 0):1===c.nodeType&&c.outerHTML!==j[a].outerHTML?(j[a].parentNode.insertBefore(c,j[a]),j[a].parentNode.removeChild(j[a]),b.target.push(c),void 0):void 0:(l.parentNode.insertBefore(c,l),b.target.push(c),void 0)})},{handle:b,scrollIntoView:c,highlight:d}}),function(a){expose(a,function(){window.Hyde=a()})}(function(){return{version:"0.1.0",bind:function(a,b,c){var d=Loop.watch(a,function(b){$.each(b,function(b,c){var e={target:[]};Flush.handle(e,c,d),location.href.indexOf("scrollIntoView")>-1&&Flush.scrollIntoView(e,a),Flush.highlight(e,a)})}),e=Handlebars.parse(b);AST.handle(e,void 0,void 0,d.$blocks={},d.$helpers={});var f=Handlebars.compile(e),g=f(d),h=$("<div>"+g+"</div>");return h.length&&scan(h[0],a),h=h.contents(),c?c.call(a,h)||a:h},unbind:function(a){return Loop.unwatch(a),this}}});
//# sourceMappingURL=dist/hyde-min.map